<div class="flex flex-col h-full bg-gray-50 relative">

    <!-- Top Bar -->
    <div
        class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 shadow-sm z-20 flex-shrink-0">
        <button (click)="goBack()"
            class="flex items-center text-gray-500 hover:text-gray-900 font-medium transition-colors">
            <span class="mr-2 text-xl">←</span> Back
        </button>
        <h1 class="font-bold text-gray-800">Review Prediction</h1>
        <div class="flex items-center space-x-2 text-xs text-gray-400">
            <span class="border px-2 py-1 rounded bg-gray-50">← Reject</span>
            <span class="border px-2 py-1 rounded bg-gray-50">→ Accept</span>
        </div>
    </div>

    <!-- Scrollable Content -->
    <div class="flex-1 overflow-y-auto p-6">
        <div class="max-w-4xl mx-auto space-y-6">

            <!-- Canvas Container -->
            <div class="relative bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden text-center p-4">
                <canvas #canvas class="max-w-full h-auto mx-auto rounded-lg shadow-inner bg-gray-100"></canvas>
                <div *ngIf="!prediction" class="p-10 text-gray-400 italic">No image loaded</div>
            </div>

            <!-- Correction Panel -->
            <div *ngIf="prediction && prediction.detections.length > 0"
                class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 animate-fade-in-up">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-4">Detections ({{
                    prediction.detections.length }})</h3>

                <div class="space-y-3">
                    <div *ngFor="let det of prediction.detections; let i = index"
                        class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100 hover:border-blue-200 transition-colors">

                        <div class="flex items-center space-x-3">
                            <span
                                class="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold">{{
                                i + 1 }}</span>
                            <div>
                                <p class="text-[10px] text-gray-400 uppercase font-mono">Confidence: {{ (det.confidence
                                    * 100).toFixed(0) }}%</p>
                            </div>
                        </div>

                        <!-- Class Selector -->
                        <div class="flex items-center space-x-2">
                            <label class="text-xs font-semibold text-gray-600 mr-2">Class:</label>
                            <select [(ngModel)]="det.class" (change)="redraw()"
                                class="block w-40 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm py-1.5 bg-white">
                                <option *ngFor="let name of classNames" [value]="name">{{ name }}</option>
                            </select>
                        </div>
                    </div>
                </div>

                <p class="text-xs text-blue-500 mt-4 flex items-center">
                    <span class="mr-1">ℹ️</span> Correct the classes above if needed, then click Accept.
                </p>
            </div>

            <!-- Empty State -->
            <div *ngIf="prediction && prediction.detections.length === 0"
                class="bg-yellow-50 text-yellow-800 p-4 rounded-xl border border-yellow-200 text-center">
                No objects detected. You can reject this image or accept it as empty background.
            </div>

        </div>
    </div>

    <!-- Sticky Bottom Action Bar -->
    <div
        class="h-20 bg-white border-t border-gray-200 flex items-center justify-center space-x-6 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-20 flex-shrink-0">
        <button (click)="reject()"
            class="group flex flex-col items-center justify-center w-32 h-14 rounded-xl border-2 border-transparent bg-red-50 text-red-600 hover:bg-red-100 hover:border-red-200 active:scale-95 transition-all">
            <span class="font-bold">Reject</span>
        </button>

        <button (click)="accept()"
            class="group flex flex-col items-center justify-center w-48 h-14 rounded-xl shadow-lg bg-green-600 text-white hover:bg-green-700 active:scale-95 transition-all">
            <span class="font-bold text-lg">Accept & Train</span>
        </button>
    </div>

    <!-- Toast -->
    <div *ngIf="toastMessage"
        class="absolute top-24 left-1/2 transform -translate-x-1/2 bg-gray-900/90 text-white px-6 py-3 rounded-full shadow-2xl flex items-center animate-fade-in-down z-50 backdrop-blur-sm border border-gray-700">
        <span class="text-green-400 mr-3 text-xl bg-green-500/20 rounded-full p-1">✓</span>
        {{ toastMessage }}
    </div>

</div>